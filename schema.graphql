# starship-schema 0.9-wip

# Users
type User {
  id: ID!
  username: String!
  admin: Boolean
  profilePicture: String
  banned: Boolean
  following: [Planet]
  memberOf: [Planet]
  createdAt: String!
  usedBytes: Float!
  capWaived: Boolean
  tfaEnabled: Boolean
  membershipLevel: Int
  expiryDate: String!
  blockedUsers: [User]
  customEmojis: [CustomEmoji]
}

# Reports
type Report {
  id: ID!
  owner: User!
  createdAt: String!
  objectType: Int!
  objectId: ID!
  reportType: Int
  details: String
  user: User!
  solved: Boolean!
}

# Planets
type PlanetComponent {
  name: String
  componentId: ID!
  type: String!
}

type Planet {
  id: ID!
  name: String!
  createdAt: String!
  owner: User!
  private: Boolean!
  followerCount: Int!
  components: [PlanetComponent]!
  homeComponent: PlanetComponent
  featured: Boolean
  verified: Boolean
  partnered: Boolean
  members: [User]
  featuredDescription: String
  invites: [Invite]
  banned: [User]
  css: String
  description: String
  customEmojis: [CustomEmoji]
}

# Invites
type Invite {
  id: ID!
  planet: Planet!
  owner: User!
  createdAt: String!
}

### ----------
### COMPONENTS
### ----------
# Page

type Page {
  id: ID!
  createdAt: String!
  owner: User!
  updatedAt: String!
  planet: Planet!
  content: String!
}

# Wiki (currently impl. as Page Group)

type Wiki {
  id: ID!
  createdAt: String!
  owner: User!
  planet: Planet!
  pages: [WikiPage]
}

type WikiPage {
  id: ID!
  wiki: Wiki!
  content: String
  planet: Planet!
  createdAt: String!
  name: String!
}

# Files

type FileComponent {
  id: ID!
  createdAt: String!
  owner: User!
  planet: Planet!
}

type FileObject {
  id: ID!
  path: [String!]
  parent: FileObject
  name: String!
  planet: Planet
  owner: User
  createdAt: String
  component: FileComponent
  type: String!
  fileType: String!
  finishedUploading: Boolean
  shareId: String!
  size: Float
}

# Forum

type Forum {
  id: ID!
  createdAt: String!
  owner: User!
  planet: Planet!
  stickiedPosts: [ForumPost]
  posts(limit: Int, cursor: String, sortMethod: String, tag: String): ForumPostFeed,
  tags: [String]
}

type ForumReaction {
  emoji: String!
  reactors: [String!]!
}

type ForumPost {
  id: ID!
  name: String!
  component: Forum!
  content: String!
  owner: User!
  planet: Planet!
  tags: [String]!
  reactions: [ForumReaction]!
  replyCount: Int!
  stickied: Boolean!
  locked: Boolean
  createdAt: String!
  updatedAt: String!
  replies(limit: Int, cursor: String): ForumReplyFeed
}

type ForumReply {
  id: ID!
  post: ForumPost!
  component: Forum!
  content: String!
  owner: User!
  planet: Planet!
  reactions: [ForumReaction]!
  stickied: Boolean!
  createdAt: String!
  updatedAt: String!
}

# Blogs

type Blog {
  id: ID!
  createdAt: String!
  owner: User!
  planet: Planet!
  posts(limit: Int, cursor: String): BlogPostFeed
}

type BlogPost {
  id: ID!
  createdAt: String!
  owner: User!
  planet: Planet!
  content: String!
  component: Blog!
  name: String!
  comments: [BlogComment]
}

type BlogComment {
  id: ID!
  createdAt: String!
  owner: User!
  blog: Blog!
  post: BlogPost!
  planet: Planet!
  content: String!
}

# Direct Messages

type DirectMessage {
  id: ID!,
  owner: User!,
  recipient: User!,
  createdAt: String!,
  content: String!,
  name: String!,
  replies(limit: Int, cursor: String): DirectMessageReplyFeed
}

type DirectMessageReply {
  id: ID!
  owner: User!
  createdAt: String!
  content: String!
}

# Misc. Types

type Notification {
  id: ID!
  user: User!
  createdAt: String!
  text: String!
  icon: String!
}

type CustomEmoji {
  id: ID!
  owner: User!
  planet: Planet
  user: User
  name: String!
  url: String!
}

### ----------
### FEED TYPES
### ----------

type ForumPostFeed {
  cursor: String!
  forumPosts: [ForumPost]
}

type ForumReplyFeed {
  cursor: String!
  forumReplies: [ForumReply]
}

type DirectMessageFeed {
  cursor: String!
  messages: [DirectMessage]
}

type DirectMessageReplyFeed {
  cursor: String!
  messageReplies: [DirectMessageReply]
}

type BlogPostFeed {
  cursor: String!
  messageReplies: [BlogPost]
}

### -----------------
### PURE RETURN TYPES
### -----------------

type LoginPayload {
  token: String!
  expectingTFA: Boolean!
}

type UploadFileData {
  documentId: String!
  uploadUrl: String!
}

type UploadMarkdownImageData {
  finalUrl: String!
  uploadUrl: String!
}

### -------------
### FUNCTIONALITY
### -------------

type Query {
  # Users
  user(id: ID!): User
  adminUser(id: ID!): User
  adminUsers(startNumber: Int!, count: Int!): [User]
  currentUser: User
  # Reports
  report(id: ID!): Report
  allReports(startNumber: Int!, count: Int!): [Report]!
  reportsByUser(userId: ID!, startNumber: Int!, count: Int!): [Report]!
  searchForPlanets(searchText: String!): [Planet]
  # Planets
  featuredPlanets: [Planet]
  planet(id: ID!): Planet
  adminPlanets(startNumber: Int!, count: Int!): [Planet]
  # Invites
  invite(id: ID!): Invite
  # Pages
  page(id: ID!): Page
  # Wiki
  wiki(id: ID!): Wiki
  wikiPage(id: ID!): WikiPage
  # Forum
  forum(id: ID!): Forum
  forumPost(id: ID!): ForumPost
  forumReply(id: ID!): ForumReply
  # Files
  fileComponent(id: ID!): FileComponent
  files(componentId: ID!, parent: String!): [FileObject]
  folders(componentId: ID!, parent: String!): [FileObject]
  fileObject(id: ID!): FileObject
  fileObjectArray(ids: [ID]!): [FileObject]!
  searchForFiles(componentId: ID!, parent: String!, searchText: String!): [FileObject]
  # AWS
  # While many of these methods *could be* included in the
  # initial object query, because they expire it's better
  # to fetch this information as needed
  downloadFileObject(fileId: ID!): String
  downloadFolderObject(folderId: ID!): [String]
  getObjectPreview(fileId: ID!): String
  # Direct Messages
  directMessages: DirectMessageFeed
  directMessage(id: ID!): DirectMessage
  directMessageReply(id: ID!): DirectMessageReply
  # Notifications
  notifications: [Notification]
  notification(id: ID!): Notification
  # Custom Emojis
  customEmoji(id: ID!): CustomEmoji
  # Blogs
  blog(id: ID!): Blog
  blogPost(id: ID!): BlogPost
  blogComment(id: ID!): BlogComment
}

type Subscription {
  notificationRecieved: Notification
}

type Mutation {
  # Users
  insertUser(email: String!, password: String!, username: String!, recaptcha: String!): User
  banUser(userId: ID!): User
  resendVerificationEmail(username: String!): Boolean
  sendResetPasswordEmail(username: String!): Boolean
  resetPassword(userId: ID!, token: String, password: String!): Boolean
  activateEmail(userId: ID!, token: String!): Boolean
  loginUser(username: String!, password: String!): LoginPayload!
  finalizeAuthorization(loginToken: String!, totpToken: Int!): LoginPayload!
  generateTOTPSecret: String
  confirmTFA(token: Int!): [Int]
  disableTFA(token: Int!): Boolean
  blockUser(id: ID!): User
  uploadUserCustomEmoji(name: String!): User
  # Reports
  insertReport(objectType: Int!, objectId: ID!, reportType: Int!, details: String!, userId: ID!): Report
  solveReport(reportId: ID!): Report
  # Planets
  insertPlanet(name: String!, private: Boolean!): Planet
  addComponent(planetId: ID!, name: String!, type: String!): Planet
  followPlanet(planetId: ID!): Planet
  removeComponent(planetId: ID!, componentId: ID!): Planet
  updateName(planetId: ID!, name: String!): Planet
  togglePrivate(planetId: ID!): Planet
  removeMember(planetId: ID!, userId: ID!): Planet
  renameComponent(planetId: ID!, name: String!, componentId: ID!): Planet
  applyModTools(planetId: ID!, featured: Boolean!, verified: Boolean!, partnered: Boolean!, featuredDescription: String!): Planet
  toggleBan(planetId: ID!, userId: ID!): Planet
  setCSS(planetId: ID!, css: String!): Planet
  setDescription(planetId: ID!, description: String!): Planet
  deletePlanet(planetId: ID!): Boolean
  uploadPlanetCustomEmoji(planetId: ID!, name: String!): Planet
  # Invites
  insertInvite(planetId: ID!): Invite
  useInvite(inviteId: ID!): Planet
  removeInvite(inviteId: ID!): Planet
  # Pages
  updatePage(pageId: ID!, content: String!): Page
  # Wikis
  insertWikiPage(wikiId: ID!, content: String!, name: String!): WikiPage
  updateWikiPage(pageId: ID!, newContent: String!): WikiPage
  removeWikiPage(pageId: ID!): Wiki
  renameWikiPage(pageId: ID!, newName: String!): WikiPage
  # Forums
  createForumTag(forumId: ID!, tag: String!): Forum
  removeForumTag(forumId: ID!, tag: String!): Forum
  insertForumPost(forumId: ID!, name: String!, content: String!, tag: String): ForumPost
  updateForumPost(postId: ID!, content: String!): ForumPost
  deleteForumPost(postId: ID!): Boolean
  lockForumPost(postId: ID!): ForumPost
  stickyForumPost(postId: ID!): ForumPost
  forumPostReact(postId: ID!, emojiId: String!): ForumPost
  insertForumReply(postId: ID!, content: String!): ForumReply
  updateForumReply(replyId: ID!, content: String!): ForumReply
  deleteForumReply(replyId: ID!): Boolean
  forumReplyReact(replyId: ID!, emojiId: String!): ForumReply
  # Files
  createFolder(componentId: ID!, parent: String!, name: String!): FileObject
  renameObject(objectId: ID!, name: String!): FileObject
  moveObject(objectIds: [ID]!, parent: String!): [FileObject]
  cancelUpload(objectId: ID!): Boolean
  # AWS
  uploadFileObject(folderId: String!, type: String!, name: String!, filesId: ID!): UploadFileData
  deleteFileObject(objectIds: [ID]!): Boolean
  uploadMarkdownImage(type: String!, size: Int!): UploadMarkdownImageData
  uploadProfilePicture(type: String!, size: Int!): String
  completeUpload(objectId: ID!): FileObject
  copyFile(objectIds: [ID]!, parent: String!): [FileObject]
  # Notifications
  clearNotification(notificationId: ID!): Boolean
  clearAllNotifications: Boolean
  # Direct Messages
  sendDirectMessage(recipient: ID!, content: String!, name: String!): DirectMessage
  updateDirectMessage(messageId: ID!, content: String!): DirectMessage
  replyToDirectMessage(messageId: ID!, content: String!): DirectMessageReply
  updateDirectMessageReply(replyId: ID!, content: String!): DirectMessageReply
  # Blogs
  insertBlogPost(blogId: ID!, content: String!, name: String!): BlogPost
  updateBlogPost(postId: ID!, content: String!): BlogPost
  renameBlogPost(postId: ID!, name: String!): BlogPost
  remobeBlogPost(postId: ID!): Boolean
  insertBlogComment(postId: ID!, content: String!): BlogComment
  editBlogComment(commentId: ID!, content: String!): BlogComment
  deleteBlogComment(commentId: ID!): Boolean
}